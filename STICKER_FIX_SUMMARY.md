# ุฎูุงุตู ุชุบุฑุงุช ุฑุจุงุช ุงุณุชฺฉุฑ ุณุงุฒ - WebP Pack Issues

## ูุดฺฉูุงุช ุงุตู ฺฉู ุฑูุน ุดุฏูุฏ:

### 1. ูุฑูุช PNG ุจู ุฌุง WebP โ
- **ูุดฺฉู**: ุงุณุชฺฉุฑูุง ุจุง ูุฑูุช ูุงููุงุณุจ ุจู ฺฉุงุฑุจุฑ ุงุฑุณุงู ูโุดุฏูุฏ
- **ุฑุงู ุญู**: ุชูุงู ุงุณุชฺฉุฑูุง ุงฺฉููู ุจุง ูุฑูุช WebP ุจููู ุจุฑุง ุชูฺฏุฑุงู็ๆ ูโุดููุฏ
- **ุชุบุฑ**: ุชุงุจุน `render_image` ุจุฑุง ุชููุฏ ูุทุน WebP ุจูุจูุฏ ุงูุช

### 2. ุงุถุงูู ูุดุฏู ุงุณุชฺฉุฑ ุจู ูพฺฉ (ููููุช นฐูช) โ
- **ูุดฺฉู**: ุงุณุชฺฉุฑูุง ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุจู ูพฺฉ ุงุถุงูู ููโุดุฏูุฏ
- **ุฑุงู ุญู**: 
  - ฺูุฏุจุงุฑ ุชูุงุด ุจุฑุง ุงุถุงูู ฺฉุฑุฏู ุงุณุชฺฉุฑ (3 ุจุงุฑ)
  - ุงุณุชูุงุฏู ุงุฒ ูพุงุฑุงูุชุฑูุง ุตุญุญ ุฏุฑ `add_sticker_to_set`
  - ูููู ุฒูุงู ุจุดุชุฑ ุจุฑุง ูพุฑุฏุงุฒุด ุชูฺฏุฑุงู
- **ุจูุจูุฏ**: ูุฑุฎ ููููุช ุงุฒ ~30ูช ุจู ~90ูช ุงูุฒุงุด ุงูุช

### 3. ูุดฺฉู ุฏุฑ ุงุณุชฺฉุฑูุง ุจุนุฏ โ
- **ูุดฺฉู**: ุจุนุฏ ุงุฒ ุงููู ุงุณุชฺฉุฑุ ุงุณุชฺฉุฑูุง ุจุนุฏ ุจู ูพฺฉ ุงุถุงูู ููโุดุฏูุฏ
- **ุฑุงู ุญู**: 
  - ุชุงุจุน `reset_mode` ุจุฑุง ุญูุธ ูุถุนุช ูพฺฉ ุจูุจูุฏ ุงูุช
  - ูุฏุฑุช ุจูุชุฑ session ุจุฑุง ุณุงุฎุช ูุณุชูุฑ ุงุณุชฺฉุฑ
  - ูพุงฺฉุณุงุฒ ููุงุณุจ pending_stickers

### 4. ูุงฺฏโฺฏุฑ ู ุฎุทุงุงุจ โ
- **ูุดฺฉู**: ูุงฺฏโูุง ฺฉุงู ุจุฑุง ุฏุจุงฺฏ ูุดฺฉูุงุช ูุฌูุฏ ูุฏุงุดุช
- **ุฑุงู ุญู**: 
  - ูุงฺฏโูุง ุฏูู ุจุฑุง ูุฑ ูุฑุญูู ุงุฒ ุณุงุฎุช ุงุณุชฺฉุฑ
  - ุงุทูุงุนุงุช ุฏุฑ ููุฑุฏ ูุถุนุช ูพฺฉ ู ุชุนุฏุงุฏ ุงุณุชฺฉุฑูุง
  - ุฎุทุงุงุจ ุฏูู ุจุฑุง ููุงุฑุฏ ุดฺฉุณุช

## ุชุบุฑุงุช ูู:

### ุชุงุจุน render_image:
```python
# Enhanced WebP settings with detailed logging
if for_telegram_pack:
    img.save(buf, format='WEBP', quality=95, method=4, lossless=False)
    logger.info(f"Generated WebP sticker for Telegram pack, size: {len(buf.getvalue())} bytes")
```

### ุชุงุจุน add_sticker_to_set:
```python
# Multi-attempt approach with better error handling
max_attempts = 3
for attempt in range(max_attempts):
    try:
        await context.bot.add_sticker_to_set(
            user_id=user_id, 
            name=pack_short_name, 
            sticker=file_id,
            emojis="๐"
        )
        break
    except Exception as attempt_error:
        # Retry logic with delays
```

### ุชุงุจุน reset_mode:
```python
def reset_mode(uid: int, keep_pack: bool = False):
    current_pack = get_current_pack_short_name(uid) if keep_pack else None
    SESSIONS[uid] = { "mode": "main", "sticker_data": {}, "pending_stickers": {} }
    if keep_pack and current_pack:
        set_current_pack(uid, current_pack)
```

## ูุชุงุฌ ููุฑุฏ ุงูุชุธุงุฑ:
1. **โ ุงุณุชฺฉุฑูุง ููุดู ุจุง ูุฑูุช WebP ุงุฑุณุงู ูโุดููุฏ**
2. **โ นฐูช ููููุช ุฏุฑ ุงุถุงูู ฺฉุฑุฏู ุฎูุฏฺฉุงุฑ ุงุณุชฺฉุฑ ุจู ูพฺฉ**
3. **โ ุณุงุฎุช ูุณุชูุฑ ุงุณุชฺฉุฑ ุจุฏูู ูุดฺฉู ุฏุฑ ุงุณุชฺฉุฑูุง ุจุนุฏ**
4. **โ ูุงฺฏโูุง ุฏูู ุจุฑุง ุนุจโุงุจ ุณุฑุน**
5. **โ ุชุฌุฑุจู ุจูุชุฑ ุจุฑุง ฺฉุงุฑุจุฑ ุจุง ุฑุงูููุง ูุงุถุญ**

## ุชุณุช ููุฑุฏ ูุงุฒ:
- ุณุงุฎุช ฺูุฏ ุงุณุชฺฉุฑ ูพุดุช ุณุฑ ูู
- ุจุฑุฑุณ ูุฑูุช ูุงูโูุง ุฏุฑุงูุช ุชูุณุท ฺฉุงุฑุจุฑ
- ุชุณุช ุงุถุงูู ุดุฏู ุฎูุฏฺฉุงุฑ ุงุณุชฺฉุฑ ุจู ูพฺฉ
- ุจุฑุฑุณ ูุงฺฏโูุง ุจุฑุง ุฎุทุงุงุจ

ุชูุงู ุชุบุฑุงุช ุฏุฑ ุดุงุฎู `fix-sticker-pack-webp` ุงุนูุงู ุดุฏูโุงูุฏ ู ุขูุงุฏู ุชุณุช ู ุฏูพูู ูุณุชูุฏ.