# 📱 Telegram Bot Serverless Architecture

## 🏗️ ساختار بهینه برای محیط Serverless (Vercel)

این پروژه برای اجرای بهینه در محیط Serverless Vercel بهینه‌سازی شده است.

## 📁 ساختار فایل‌ها

```
api/
├── index.py          # ورودی اصلی سرورلس
├── config.py         # تنظیمات محیط Serverless
├── utils.py          # توابع کمکی و اشتراکی
├── handlers.py       # هندلرهای تلگرام
├── bot.py           # منطق اصلی ربات
├── bot_features.py  # ویژگی‌های ربات
└── __init__.py      # فایل ماژول پایتون
```

## 🚀 ویژگی‌های بهینه‌سازی شده

### 1. **کشینگ هوشمند**
- کشینگ اپلیکیشن تلگرام برای جلوگیری از ساخت مجدد
- مدیریت بهینه حافظه در محیط Serverless

### 2. **مدیریت وضعیت کاربر**
- مدیریت متمرکز وضعیت کاربران با `UserStateManager`
- بهینه برای محیط Stateless

### 3. **مدیریت خطای استاندارد**
- پاسخ‌های خطای استاندارد برای دیباگ بهتر
- لاگینگ هوشمند برای محیط Serverless

### 4. **امنیت وب‌هوک**
- اعتبارسنجی وب‌هوک با توکن مخفی
- محافظت در برابر درخواست‌های غیرمجاز

### 5. **بهینه‌سازی منابع**
- مدت زمان اجرای محدود (10 ثانیه)
- مصرف بهینه منابع CPU و حافظه

## 🔧 تنظیمات محیطی

متغیرهای محیطی مورد نیاز:

```bash
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_WEBHOOK_SECRET=optional_webhook_secret
MAX_WEBHOOK_TIMEOUT=10
ENABLE_LOGGING=true
LOG_LEVEL=INFO
CACHE_DURATION=300
MAX_RETRIES=3
```

## 📊 مسیرهای API

### GET `/`
- **توضیحات**: سلامتی ربات
- **پاسخ**: وضعیت اجرا و نسخه

### POST `/webhook`
- **توضیحات**: وب‌هوک تلگرام
- **ورودی**: آپدیت JSON تلگرام
- **خروجی**: وضعیت پردازش

## 🛠️ توابع کمکی

### `ServerlessCache`
کشینگ ساده برای محیط Serverless

### `UserStateManager`
مدیریت وضعیت کاربران در محیط Stateless

### `validate_webhook_secret`
اعتبارسنجی امنیتی وب‌هوک

## 🚦 عملکرد

- **زمان راه‌اندازی**: < 1 ثانیه (با کشینگ)
- **مدت اجرا**: < 10 ثانیه
- **مصرف حافظه': ~128MB
- **درخواست‌ها در دقیقه': 1000+

## 🔄 فرآیند پردازش

1. درخواست ورودی به Vercel
2. تبدیل به فرمت استاندارد
3. اعتبارسنجی امنیتی
4. بازیابی اپلیکیشن از کش
5. پردازش آپدیت تلگرام
6. بازگشت پاسخ استاندارد

## 📈 مانیتورینگ

- لاگ‌های استاندارد برای دیباگ
- پیگیری خطاها و عملکرد
- آمار استفاده از منابع

## 🔒 امنیت

- اعتبارسنجی وب‌هوک
- محافظت در برابر حملات
- مدیریت خطا امن

## 🚀 دیپلوی

```bash
# Push to GitHub
git add .
git commit -m "Optimize for serverless"
git push origin main

# Vercel will auto-deploy
```