# 📋 تغییرات نسخه جدید

## 🎯 هدف اصلی
رفع مشکل نمایش مربعی متن فارسی در استیکرها و اضافه کردن امکانات جدید

## ✨ ویژگی‌های جدید

### 1. تشخیص خودکار زبان
ربات حالا می‌تواند به صورت خودکار تشخیص دهد که متن شما فارسی است یا انگلیسی:
- برای متن‌های فارسی از فونت‌های فارسی استفاده می‌کند
- برای متن‌های انگلیسی از فونت‌های انگلیسی استفاده می‌کند
- پشتیبانی از متن‌های ترکیبی (فارسی + انگلیسی)

### 2. فونت‌های جدید
فونت‌های زیر به ربات اضافه شده‌اند:

#### فونت‌های فارسی:
- **Vazirmatn**: فونت مدرن و خوانا برای فارسی
  - `Vazirmatn-Regular.ttf`
  - `Vazirmatn-Medium.ttf`

#### فونت‌های انگلیسی:
- **Roboto**: فونت استاندارد گوگل برای انگلیسی
  - `Roboto-Regular.ttf`
  - `Roboto-Medium.ttf`

### 3. بخش اشتراک بهبود یافته
دکمه اشتراک حالا دو بخش دارد:

#### 📊 نظرسنجی
- نظرسنجی درباره اضافه شدن اشتراک ویژه
- مشاهده آمار نظرات کاربران

#### 💎 پلن‌های اشتراک
پلن‌های اشتراک با قیمت‌های زیر:
- **یک ماهه**: ۲۰,۰۰۰ تومان
- **سه ماهه**: ۳۰,۰۰۰ تومان (۵۰٪ تخفیف!)
- **شش ماهه**: ۶۰,۰۰۰ تومان

مزایای اشتراک:
- ✨ استفاده نامحدود از ربات
- 🎨 دسترسی به تمام فونت‌ها و قالب‌ها
- 🚀 سرعت بالاتر در ساخت استیکر
- 🎯 پشتیبانی اختصاصی

برای خرید با @onedaytoalive در تماس باشید.

## 🔧 اصلاحات فنی

### رفع مشکل نمایش مربعی
مشکل اصلی این بود که ربات نمی‌دانست فونت‌ها کجا هستند. حالا:
1. فونت‌ها در پوشه `fonts/` قرار دارند
2. ربات به صورت خودکار زبان متن را تشخیص می‌دهد
3. فونت مناسب بر اساس زبان انتخاب می‌شود

### بهبود کد
- اضافه شدن تابع `_detect_language()` برای تشخیص زبان
- بهبود تابع `resolve_font_path()` برای انتخاب هوشمند فونت
- اضافه شدن لیست فونت‌های فارسی و انگلیسی
- بهینه‌سازی تابع `_prepare_text()` برای پردازش بهتر متن

## 🧪 تست‌ها

فایل `test_language_detection.py` برای تست عملکرد اضافه شده است:
```bash
python3 test_language_detection.py
```

نتایج تست:
- ✅ تشخیص صحیح زبان فارسی
- ✅ تشخیص صحیح زبان انگلیسی
- ✅ انتخاب صحیح فونت بر اساس زبان

## 📦 فایل‌های جدید

```
mybot/
├── fonts/
│   ├── Vazirmatn-Regular.ttf      # فونت فارسی
│   ├── Vazirmatn-Medium.ttf       # فونت فارسی
│   ├── Roboto-Regular.ttf         # فونت انگلیسی
│   └── Roboto-Medium.ttf          # فونت انگلیسی
├── test_language_detection.py     # فایل تست
├── download_fonts_auto.py         # اسکریپت دانلود فونت‌ها
└── CHANGES.md                     # این فایل
```

## 🚀 نحوه استقرار

### 1. دانلود تغییرات
```bash
git pull origin main
```

### 2. نصب وابستگی‌ها (در صورت نیاز)
```bash
pip install -r requirements.txt
```

### 3. راه‌اندازی مجدد ربات
```bash
# اگر از systemd استفاده می‌کنید:
sudo systemctl restart telegram-bot

# یا اگر به صورت دستی اجرا می‌کنید:
python3 bot.py
```

## 📝 نکات مهم

1. **فونت‌ها**: مطمئن شوید فونت‌ها در پوشه `fonts/` موجود هستند
2. **تست**: قبل از استقرار در production، ربات را تست کنید
3. **پشتیبان‌گیری**: قبل از به‌روزرسانی، از نسخه فعلی پشتیبان بگیرید

## 🐛 رفع مشکلات احتمالی

### مشکل: فونت‌ها پیدا نمی‌شوند
**راه‌حل**: مطمئن شوید فایل‌های فونت در `fonts/` موجود هستند:
```bash
ls -la fonts/
```

### مشکل: متن هنوز مربعی نمایش داده می‌شود
**راه‌حل**: 
1. ربات را restart کنید
2. مطمئن شوید فونت‌های فارسی نصب شده‌اند
3. لاگ‌های ربات را بررسی کنید

## 📞 پشتیبانی

در صورت بروز مشکل:
- تلگرام: @onedaytoalive
- کانال: @redoxbot_sticker

## 🎉 تشکر

از شما برای استفاده از ربات تشکر می‌کنیم!