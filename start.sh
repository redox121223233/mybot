#!/bin/bash

# ุงุณฺฉุฑูพุช ุฑุงูโุงูุฏุงุฒ ุฑุจุงุช ุงุณุชฺฉุฑ ุณุงุฒ

echo "๐ ุฏุฑ ุญุงู ุฑุงูโุงูุฏุงุฒ ุฑุจุงุช ุงุณุชฺฉุฑ ุณุงุฒ..."

# ุจุฑุฑุณ ูุตุจ Python
if ! command -v python3 &> /dev/null; then
    echo "โ Python3 ูุตุจ ูุณุช. ูุทูุงู ุงุจุชุฏุง Python ุฑุง ูุตุจ ฺฉูุฏ."
    exit 1
fi

# ุจุฑุฑุณ ูุตุจ FFmpeg
if ! command -v ffmpeg &> /dev/null; then
    echo "โ๏ธ  ูุดุฏุงุฑ: FFmpeg ูุตุจ ูุณุช. ุงุณุชฺฉุฑูุง ูุฏู ฺฉุงุฑ ูุฎูุงููุฏ ฺฉุฑุฏ."
    echo "ุจุฑุง ูุตุจ FFmpeg:"
    echo "  Ubuntu/Debian: sudo apt install ffmpeg"
    echo "  CentOS/RHEL: sudo yum install ffmpeg"
fi

# ุจุฑุฑุณ ูุฌูุฏ ูุงู .env
if [ ! -f .env ]; then
    echo "โ ูุงู .env ูุฌูุฏ ูุฏุงุฑุฏ. ูุทูุงู ุงุจุชุฏุง BOT_TOKEN ุฑุง ุฏุฑ ูุงู .env ุชูุธู ฺฉูุฏ."
    exit 1
fi

# ุจุฑุฑุณ ูุฌูุฏ ูููุชโูุง
if [ ! -d "fonts" ] || [ -z "$(ls -A fonts/*.ttf 2>/dev/null)" ]; then
    echo "โ๏ธ  ูุดุฏุงุฑ: ูพูุดู fonts ุฎุงู ุงุณุช. ูุทูุงู ูููุชโูุง ูุงุฑุณ ุฑุง ุฏุงูููุฏ ฺฉูุฏ."
    echo "ุฑุงูููุง: fonts/README.md ุฑุง ูุทุงูุนู ฺฉูุฏ."
fi

# ุจุฑุฑุณ ูุตุจ ฺฉุชุงุจุฎุงููโูุง
echo "๐ฆ ุจุฑุฑุณ ฺฉุชุงุจุฎุงููโูุง ููุฑุฏ ูุงุฒ..."
if ! python3 -c "import aiogram" &> /dev/null; then
    echo "๐ฅ ุฏุฑ ุญุงู ูุตุจ ฺฉุชุงุจุฎุงููโูุง..."
    pip3 install -r requirements.txt
fi

# ุณุงุฎุช ุชุตูุฑ ฺฏุฑุงุฏุงูุช ูพุดโูุฑุถ (ุฏุฑ ุตูุฑุช ูุจูุฏ)
if [ ! -f "templates/gradient.png" ]; then
    echo "๐จ ุฏุฑ ุญุงู ุณุงุฎุช ุชุตูุฑ ูพุดโูุฑุถ..."
    python3 create_gradient.py
fi

echo "โ ููู ฺุฒ ุขูุงุฏู ุงุณุช!"
echo "๐ค ุฏุฑ ุญุงู ุงุฌุฑุง ุฑุจุงุช..."
echo ""

# ุงุฌุฑุง ุฑุจุงุช
python3 bot.py
